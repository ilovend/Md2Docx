# 2. 采用 Electron + FastAPI 前后端分离架构

**状态**: 已接受

**日期**: 2026-01-26

## 背景 (Context)

我们需要为Md2Docx选择一个合适的桌面应用架构。该工具需要：

1. **跨平台支持**：Windows、macOS、Linux
2. **现代化界面**：响应式、美观、易用
3. **强大的文档处理能力**：Word文档解析和修改
4. **灵活的规则引擎**：支持复杂的规则配置和执行

我们考虑了以下架构选项：

### 选项A：纯Electron (Node.js后端)

- 前端：React + Electron Renderer
- 后端：Node.js + docx库
- 优点：统一技术栈，部署简单
- 缺点：Node.js的Word处理库不如Python成熟

### 选项B：Electron + 内嵌Python

- 前端：React + Electron Renderer
- 后端：Python (通过child_process运行)
- 通信：IPC + HTTP
- 优点：利用Python生态的强大文档处理能力
- 缺点：架构复杂，需要打包Python运行时

### 选项C：Tauri + Python后端

- 前端：React + Tauri WebView
- 后端：Python FastAPI
- 优点：包体积小，内存占用低
- 缺点：Tauri生态不如Electron成熟，调试困难

## 决策 (Decision)

我们选择 **选项B：Electron + 内嵌Python** 架构。

具体技术选型：

| 组件       | 技术               | 理由                      |
| :--------- | :----------------- | :------------------------ |
| 桌面框架   | Electron           | 跨平台成熟，生态丰富      |
| 前端框架   | React + TypeScript | Figma原型已采用，团队熟悉 |
| 后端框架   | Python + FastAPI   | 异步支持，自动API文档     |
| 文档处理   | python-docx        | Python最成熟的Word处理库  |
| 前后端通信 | HTTP (RESTful API) | 简单可靠，调试方便        |

**进程模型**：

```
┌─────────────────────────────────────────┐
│  Electron 应用                           │
│  ┌─────────────────────────────────────┐ │
│  │  主进程 (Main Process)               │ │
│  │  - 窗口管理                          │ │
│  │  - Python进程管理                    │ │
│  │  - IPC处理                           │ │
│  └─────────────────────────────────────┘ │
│  ┌─────────────────────────────────────┐ │
│  │  渲染进程 (Renderer Process)         │ │
│  │  - React UI                          │ │
│  │  - HTTP API 调用                     │ │
│  └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
         │
         │ spawn / HTTP
         ▼
┌─────────────────────────────────────────┐
│  Python 后端进程                         │
│  - FastAPI 服务                          │
│  - 规则引擎                              │
│  - python-docx 文档处理                  │
└─────────────────────────────────────────┘
```

**打包策略**：

- 使用 PyInstaller 将 Python 后端打包为独立可执行文件
- 使用 electron-builder 将整体应用打包
- 最终产物为单一安装包，无需用户安装Python

## 后果 (Consequences)

### 正面

1. **强大的文档处理能力**：python-docx 提供全面的Word文档操作支持
2. **开发效率**：前后端可独立开发和测试
3. **调试友好**：HTTP API 可用 curl/Postman 单独测试
4. **易于扩展**：后端可添加新的规则类型和处理器
5. **UI现代化**：可使用丰富的React生态组件

### 负面

1. **包体积较大**：需要打包Python运行时（约50-100MB）
2. **启动时间**：需要启动Python进程，初始加载较慢
3. **架构复杂性**：两套技术栈，需要管理进程通信
4. **资源占用**：同时运行Electron和Python进程

### 缓解措施

| 问题     | 缓解措施                                |
| :------- | :-------------------------------------- |
| 包体积大 | 使用 PyInstaller 优化，排除不必要的依赖 |
| 启动慢   | 应用启动时提前启动Python进程            |
| 进程管理 | 封装进程管理模块，处理异常和重启        |
| 资源占用 | 优化Python内存使用，按需加载模块        |

## 相关文档

- [设计文档](../../../DESIGN_DOC.md)
- [架构文档](../../../ARCHITECTURE.md)
- [前端架构](FRONTEND.md)
- [后端架构](BACKEND.md)
